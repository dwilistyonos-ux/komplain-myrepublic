<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Center MyRepublic</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #622d91;
            --secondary-color: #00d2ff;
            --accent-color: #ff3d00;
            --success-color: #25d366;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-bg: #ffffff;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: var(--bg-gradient); 
            min-height: 100vh;
            display: flex;
            align-items: center; justify-content: center;
            padding: 20px; margin: 0;
            color: #2d3436; 
        }

        .container { 
            max-width: 500px; width: 100%;
            background: var(--card-bg); 
            padding: 40px; border-radius: 24px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
        }

        h2 { color: var(--primary-color); text-align: center; margin-bottom: 5px; font-weight: 800; }
        .title-divider { border-bottom: 3px dotted #ccc; width: 60%; margin: 0 auto 25px auto; }

        .note { 
            background: #fff4f4; color: #d93025; padding: 15px; border-radius: 12px; 
            font-size: 0.85em; margin-bottom: 25px; border-left: 4px solid var(--accent-color); 
            line-height: 1.5;
        }

        .form-group { margin-bottom: 20px; }
        
        label { 
            display: block; font-weight: 800; font-size: 0.9em; 
            margin-bottom: 8px; color: #2d3436; font-style: italic; 
        }

        input, textarea, .custom-select { 
            width: 100%; padding: 12px 15px; border: 2px solid #edf2f7; 
            border-radius: 12px; font-size: 14px; box-sizing: border-box;
            background: #fff;
        }

        .custom-select {
            cursor: pointer; display: flex; justify-content: space-between; align-items: center; color: #636e72;
        }

        .dropdown-menu {
            display: none; background: white; width: 100%;
            border: 2px solid #edf2f7; border-radius: 12px;
            max-height: 400px; overflow-y: auto; margin-top: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .dropdown-menu.show { display: block; }

        .search-box {
            position: sticky; top: 0; background: white; padding: 10px;
            z-index: 11; border-bottom: 1px solid #eee;
        }
        .search-box input {
            padding: 10px; border: 1px solid var(--primary-color);
            border-radius: 8px; font-size: 13px;
        }

        .cat-head {
            display: block; padding: 12px 15px; font-weight: 800; 
            background: #f8f9fa; color: var(--primary-color);
            text-transform: uppercase; font-size: 0.75em; position: sticky; top: 55px; z-index: 10;
        }

        .opt-item {
            display: flex; align-items: center; padding: 10px 15px; 
            cursor: pointer; border-bottom: 1px solid #f1f2f6;
        }

        .opt-item:hover { background: #f0f7ff; }
        .opt-item input { width: 18px; height: 18px; margin-right: 12px; }

        .btn-selesai-container {
            padding: 10px; background: #f8f9fa; position: sticky; bottom: 0;
            border-top: 1px solid #eee; z-index: 10;
        }
        .btn-selesai {
            width: 100%; padding: 10px; background: var(--primary-color);
            color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;
        }

        .btn-whatsapp { 
            width: 100%; background: var(--success-color); color: white; 
            padding: 16px; border-radius: 14px; font-weight: 700; border: none;
            cursor: pointer; font-size: 16px; transition: 0.3s;
        }

        #panduan {
            display: none; background: #e8f4fd; padding: 18px; border-radius: 15px; 
            margin-bottom: 25px; font-size: 0.88em; border-left: 6px solid var(--primary-color);
            color: #2c3e50; line-height: 1.6;
        }

        .footer-saran {
            margin-top: 12px; padding-top: 10px;
            border-top: 1px dashed #adbac7; font-weight: 700;
            color: #d93025; font-style: italic;
        }

        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 9999;
            align-items: center; justify-content: center;
        }
        .modal-box { background: white; padding: 30px; border-radius: 20px; max-width: 400px; width: 90%; text-align: center; }
        .modal-footer { display: flex; gap: 10px; margin-top: 20px; }
        .btn-m { flex: 1; padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; border: none; }
        .btn-back { background: #f1f2f6; color: #57606f; }
        .btn-confirm { background: var(--success-color); color: white; }
    </style>
</head>
<body>

<div class="container">
    <h2>Komplain MyRepublic</h2>
    <div class="title-divider"></div>

    <div class="note">
        <strong>‚ö†Ô∏è PENTING:</strong><br>
        Lampirkan bukti screenshot/foto kerusakan. Video Router WiFi selama 10 detik dan kirim manual lewat WhatsApp.
    </div>

    <form id="complaintForm">
        <div class="form-group">
            <label>Nama Lengkap</label>
            <input type="text" id="nama" placeholder="Sesuai KTP" required>
        </div>

        <div class="form-group">
            <label>ID Pelanggan</label>
            <input type="number" id="id_pelanggan" placeholder="ID Pelanggan" required>
        </div>

        <div class="form-group">
            <label>Nomor WhatsApp</label>
            <input type="tel" id="no_hp" placeholder="0812xxxx" required>
        </div>

        <div class="form-group">
            <label>Alamat Pemasangan</label>
            <textarea id="alamat" rows="2" placeholder="Alamat lengkap" required></textarea>
        </div>

        <div class="form-group">
            <label>Jenis Kendala (Maks. 5 Pilihan)</label>
            <div class="custom-select" id="selectToggle">
                <span id="select-label">-- Klik untuk Pilih Kendala --</span>
                <span>‚ñº</span>
            </div>
            <div class="dropdown-menu" id="menuKendala">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Cari (cth: LOS, Lelet, Putus)..." onkeyup="filterKendala()">
                </div>
                <div id="listKendala"></div>
            </div>
        </div>

        <div id="panduan">
            <strong>üí° Saran Mandiri Relevan:</strong><br>
            <div id="tipsContent"></div>
            <div class="footer-saran">
                Note : apabila jaringan WiFi masih eror harap hubungi saya kembali.
            </div>
        </div>

        <button type="button" class="btn-whatsapp" onclick="showPopup()">Kirim via WhatsApp</button>
    </form>
</div>

<div id="modalConfirm" class="modal-overlay">
    <div class="modal-box">
        <h3>Konfirmasi Data</h3>
        <p>
            Pastikan <strong>Id Pelanggan, Nama, Nomor Hp, dan Alamat</strong> sudah benar.<br><br>
            Perbaikan WiFi akan membutuhkan waktu paling lama <strong>24 Jam</strong>. Apabila masih terjadi lelet, hubungi saya kembali.<br><br>
            Terima kasih üôè
        </p>
        <div class="modal-footer">
            <button class="btn-m btn-back" onclick="closePopup()">Cek Lagi</button>
            <button class="btn-m btn-confirm" onclick="sendWhatsApp()">Ya, Sudah Benar</button>
        </div>
    </div>
</div>

<script>
    const menu = document.getElementById('menuKendala');
    const listKendala = document.getElementById('listKendala');
    const selectToggle = document.getElementById('selectToggle');
    
    const dataKendala = {
        "MASALAH FISIK & PERANGKAT": [
            "Kabel Fiber Optik Putus", "Router Lampu LOS Merah", "Router Lampu PON Berkedip",
            "Router Mati Total", "Adaptor Power Rusak/Mati", "Router Terasa Sangat Panas",
            "Router Sering Restart Sendiri", "Kabel LAN Tidak Terdeteksi", "Port LAN Router Rusak"
        ],
        "KONEKSI INTERNET & WIFI": [
            "Internet Tidak Nyambung", "WiFi Lelet / Lambat", "Sinyal WiFi Sering Hilang",
            "Koneksi Sering Putus Nyambung", "WiFi Terhubung Tapi No Internet", "Sering RTO (Request Time Out)",
            "Ping Game Tinggi / Lag", "WiFi Tidak Terdeteksi di HP/Laptop", "DNS Error / Tidak Bisa Browsing"
        ],
        "APLIKASI & SOSIAL MEDIA": [
            "WhatsApp Lelet / Pending", "YouTube Buffering Terus", "Instagram Tidak Bisa Refresh",
            "TikTok Loading / Lag", "Facebook Tidak Bisa Buka Gambar", "Netflix / Disney+ Lelet",
            "Zoom / Google Meet Putus-putus", "M-Banking Tidak Bisa Login", "Shopee / Tokopedia Loading Lama"
        ],
        "GAME ONLINE": [
            "Mobile Legends Lag / Merah", "PUBG / Free Fire High Ping", "Valorant Koneksi Error",
            "Genshin Impact Reconnecting", "Roblox Tidak Bisa Masuk Server", "PlayStation Network Sign-in Failed"
        ]
    };

    const solusiKamus = {
        "WhatsApp": "‚Ä¢ Bersihkan Cache WhatsApp atau restart HP Anda.",
        "LOS": "‚Ä¢ Cabut dan pasang kembali kabel kuning di belakang router.",
        "Mati": "‚Ä¢ Coba pindahkan adaptor ke colokan listrik lain.",
        "Internet": "‚Ä¢ Restart Router (matikan 30 detik lalu nyalakan).",
        "WiFi": "‚Ä¢ Pastikan router diletakkan di area terbuka tanpa penghalang.",
        "Lelet": "‚Ä¢ Coba matikan WiFi di perangkat lain yang tidak terpakai.",
        "Putus": "‚Ä¢ Jangan menekuk kabel kuning karena sensitif.",
        "Game": "‚Ä¢ Gunakan kabel LAN untuk koneksi yang lebih stabil."
    };

    Object.keys(dataKendala).forEach(cat => {
        let h = document.createElement('span'); 
        h.className = 'cat-head'; h.innerText = cat;
        listKendala.appendChild(h);
        
        dataKendala[cat].forEach(item => {
            let d = document.createElement('div'); 
            d.className = 'opt-item';
            d.innerHTML = `<input type="checkbox" name="kd" value="${item}"><span style="font-size:14px;">${item}</span>`;
            d.onclick = (e) => {
                // Keyboard ditutup HANYA saat memilih item kendala agar daftar terlihat jelas
                document.activeElement.blur();
                const cb = d.querySelector('input');
                const checked = document.querySelectorAll('input[name="kd"]:checked');
                if (!cb.checked && checked.length >= 5) { alert("Maksimal 5 kendala."); return; }
                cb.checked = !cb.checked;
                updateUI(); e.stopPropagation();
            };
            listKendala.appendChild(d);
        });
    });

    const selesaiDiv = document.createElement('div');
    selesaiDiv.className = 'btn-selesai-container';
    selesaiDiv.innerHTML = `<button type="button" class="btn-selesai" onclick="closeDropdown()">Selesai & Simpan</button>`;
    menu.appendChild(selesaiDiv);

    function filterKendala() {
        let input = document.getElementById('searchInput').value.toLowerCase();
        let items = listKendala.getElementsByClassName('opt-item');
        let cats = listKendala.getElementsByClassName('cat-head');
        for (let i = 0; i < items.length; i++) {
            let text = items[i].innerText.toLowerCase();
            items[i].style.display = text.includes(input) ? "flex" : "none";
        }
        for (let j = 0; j < cats.length; j++) {
            cats[j].style.display = input === "" ? "block" : "none";
        }
    }

    function closeDropdown() { 
        menu.classList.remove('show'); 
    }

    selectToggle.onclick = (e) => { 
        // Keyboard hanya ditutup jika kita membuka dropdown, kolom input lain tidak terganggu
        if (!menu.classList.contains('show')) {
            document.activeElement.blur();
        }
        menu.classList.toggle('show'); 
        if (menu.classList.contains('show')) {
            setTimeout(() => { selectToggle.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100);
        }
        e.stopPropagation(); 
    };

    // PERBAIKAN: Menghapus document.activeElement.blur() dari window.onclick 
    // agar tidak mematikan keyboard kolom Nama/ID saat layar lain diklik.
    window.onclick = (e) => { 
        if (!e.target.closest('.custom-select') && !e.target.closest('.dropdown-menu')) {
            closeDropdown();
        }
    };

    function updateUI() {
        const checked = document.querySelectorAll('input[name="kd"]:checked');
        document.getElementById('select-label').innerText = checked.length > 0 ? `${checked.length} Kendala Terpilih` : "-- Klik untuk Pilih Kendala --";
        const pnd = document.getElementById('panduan');
        const tips = document.getElementById('tipsContent');
        if (checked.length > 0) {
            pnd.style.display = 'block';
            let kumpulanTips = new Set();
            checked.forEach(c => {
                Object.keys(solusiKamus).forEach(key => {
                    if (c.value.toLowerCase().includes(key.toLowerCase())) kumpulanTips.add(solusiKamus[key]);
                });
            });
            tips.innerHTML = kumpulanTips.size === 0 ? "‚Ä¢ Silakan lakukan Power Cycle (Restart Router)." : Array.from(kumpulanTips).join("<br>");
        } else { pnd.style.display = 'none'; }
    }

    function showPopup() { 
        if(!document.getElementById('nama').value || !document.getElementById('id_pelanggan').value) { alert("Lengkapi data!"); return; }
        document.getElementById('modalConfirm').style.display = 'flex'; 
    }
    
    function closePopup() { document.getElementById('modalConfirm').style.display = 'none'; }

    function sendWhatsApp() {
        const now = new Date();
        const hari = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"][now.getDay()];
        const tanggal = now.toISOString().split('T')[0];
        const nama = document.getElementById('nama').value;
        const id = document.getElementById('id_pelanggan').value;
        const hp = document.getElementById('no_hp').value;
        const kendala = Array.from(document.querySelectorAll('input[name="kd"]:checked')).map(c => c.value).join(", ");
        const alamat = document.getElementById('alamat').value;

        const message = `*dear cs MyRepublic*%0A` +
                        `------------------------------------------%0A` +
                        `*Hari:* ${hari}%0A` +
                        `*Tanggal:* ${tanggal}%0A` +
                        `üë§ *Nama:* ${nama}%0A` +
                        `üÜî *ID Pelanggan:* ${id}%0A` +
                        `üì± *No. HP:* ${hp}%0A` +
                        `‚öôÔ∏è *Kendala:* ${kendala}%0A` +
                        `üìç *Alamat:* ${alamat}%0A` +
                        `------------------------------------------%0A` +
                        `_Mohon bantuan untuk pengecekan dan tindak lanjut laporan di atas. Terima kasih._`;

        window.open(`https://wa.me/6281908999242?text=${message}`, '_blank');
        closePopup();
    }
</script>
</body>
</html>
